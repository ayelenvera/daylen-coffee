import{r,s as j,b as q,d as u,w as z,f as e,g as c,i as k,t as v,F as H,h as P,n as U,l as F,m as G,N as n,x as I}from"./app-BYhsu56_.js";import{_ as R}from"./AdminLayout-CYyKNtv3.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./HelpLink-0Gkg05qS.js";const J={class:"p-6"},K={class:"mb-6 flex flex-wrap justify-center gap-3 mx-4"},Q={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50"},W={class:"bg-blue-600 text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-4 animate-pulse border-2 border-blue-400"},X={class:"flex items-center space-x-3"},Z={class:"font-medium"},ee=["disabled"],te=["disabled"],se={key:0,class:"text-center py-8"},le={key:1,class:"text-center py-8"},oe={class:"text-red-600"},ae={key:2,class:"bg-white shadow rounded-lg mx-4"},re={class:"overflow-x-auto"},ne={class:"min-w-full divide-y divide-gray-200"},ie={class:"bg-gray-50"},de={class:"w-12 px-6 py-3"},ue=["checked"],ce={class:"divide-y divide-gray-200"},ve={class:"px-6 py-4"},me=["value"],pe={class:"px-6 py-4 text-sm font-medium text-gray-900"},xe={class:"px-6 py-4"},he={class:"text-sm font-medium text-gray-900"},ge={class:"text-sm text-gray-500"},fe={class:"px-6 py-4 text-sm text-gray-900"},ye={class:"px-6 py-4"},be=["onChange","value"],_e={class:"px-6 py-4 text-sm text-gray-500"},ke={class:"px-6 py-4 text-sm font-medium"},we={class:"flex space-x-2"},Ee=["onClick"],Ce=["onClick","disabled"],Se={key:3,class:"text-center py-12"},Te={__name:"Orders_new",props:{orders:{type:Array,default:()=>[]}},setup(C){const w=C,i=r(w.orders),y=r(!1),m=r(""),o=r([]),p=r(!1),a=r(null),h=r(5),d=r(null),b=r(null),g=r(!1),f=r(!1);j(()=>w.orders,s=>{i.value=s||[],o.value=[],!p.value&&!a.value&&(d.value&&clearTimeout(d.value),d.value=null,a.value=null)});const S=async()=>{y.value=!0;try{await n.reload({only:["orders"]})}catch{m.value="Error al cargar pedidos"}finally{y.value=!1}},T=()=>{o.value=o.value.length===i.value.length?[]:i.value.map(s=>s.id)},D=s=>Number(s||0).toLocaleString("es-PY",{maximumFractionDigits:0}),M=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),O=s=>{window.open(`/orders/invoice/${s.id}`,"_blank")},A=async(s,t)=>{try{await n.patch(`/admin/orders/${s}/status`,{status:t},{preserveScroll:!0,onSuccess:()=>{n.reload({only:["orders"]})},onError:()=>{m.value="Error al actualizar el estado del pedido"}})}catch(l){console.error("Error updating order status:",l)}},V=async s=>{if(confirm("¿Estás seguro de que quieres eliminar este pedido?")){b.value=s;try{const t=i.value.find(l=>l.id===s);a.value={type:"selected",orders:[t]},await n.delete(`/admin/orders/${s}`,{onSuccess:()=>{_(),n.reload({only:["orders"]})},onError:()=>{m.value="Error al eliminar",a.value=null}})}finally{b.value=null}}},B=async()=>{if(o.value.length!==0&&confirm(`¿Estás seguro de que quieres eliminar ${o.value.length} pedido${o.value.length!==1?"s":""}?`)){g.value=!0;try{const s=i.value.filter(t=>o.value.includes(t.id));a.value={type:"selected",orders:s},await n.post("/admin/orders/bulk-delete",{order_ids:o.value},{onSuccess:()=>{_(),o.value=[],n.reload({only:["orders"]})},onError:t=>{m.value="Error al eliminar",a.value=null}})}finally{g.value=!1}}},$=async()=>{if(confirm("¿Estás COMPLETAMENTE SEGURO de que quieres eliminar TODOS los pedidos?")){f.value=!0;try{a.value={type:"all",orders:[...i.value]},await n.post("/admin/orders/delete-all",{},{onSuccess:()=>{_(),o.value=[],n.reload({only:["orders"]})},onError:s=>{m.value="Error al eliminar",a.value=null}})}finally{f.value=!1}}},L=async()=>{if(a.value){p.value=!1,d.value&&clearTimeout(d.value);try{await n.post("/admin/orders/restore",{undo_data:a.value},{onSuccess:()=>{n.reload({only:["orders"]}),a.value=null},onError:()=>{m.value="Error al restaurar"}})}catch(s){console.error("Error restaurando:",s)}}},_=()=>{p.value=!0,h.value=5,I(()=>{const s=()=>{h.value--,h.value>0?d.value=setTimeout(s,1e3):(p.value=!1,a.value=null,d.value=null)};d.value=setTimeout(s,1e3)})},N=()=>{p.value=!1,d.value&&clearTimeout(d.value),a.value=null};return(s,t)=>(u(),q(R,null,{default:z(()=>[e("div",J,[t[15]||(t[15]=e("div",{class:"mb-6"},[e("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"Gestión de Pedidos"),e("p",{class:"text-gray-600"},"Administra todos los pedidos del sistema")],-1)),e("div",K,[p.value&&a.value?(u(),c("div",Q,[e("div",W,[t[1]||(t[1]=e("svg",{class:"w-6 h-6 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)),e("div",X,[e("span",Z,"¿Deshacer eliminación? ("+v(h.value)+"s)",1),e("button",{onClick:L,class:"bg-blue-700 hover:bg-blue-800 px-4 py-2 rounded font-medium transition-colors"}," Deshacer "),e("button",{onClick:N,class:"bg-blue-500 hover:bg-blue-600 px-3 py-2 rounded font-medium transition-colors",title:"Cancelar"}," ✕ ")])])])):k("",!0),o.value.length>=2?(u(),c("button",{key:1,onClick:B,disabled:g.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white font-bold py-3 px-6 rounded-lg flex items-center space-x-2"},[t[2]||(t[2]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),e("span",null,v(g.value?"Eliminando...":`Eliminar Seleccionados (${o.value.length})`),1)],8,ee)):k("",!0),i.value.length>0?(u(),c("button",{key:2,onClick:$,disabled:f.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white font-bold py-3 px-6 rounded-lg flex items-center space-x-2"},[t[3]||(t[3]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),e("span",null,v(f.value?"Eliminando...":"Eliminar Todo"),1)],8,te)):k("",!0)]),y.value?(u(),c("div",se,[...t[4]||(t[4]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-amber-600"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Cargando pedidos...",-1)])])):m.value?(u(),c("div",le,[e("p",oe,v(m.value),1),e("button",{onClick:S,class:"mt-4 bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded"},"Reintentar")])):i.value.length>0?(u(),c("div",ae,[e("div",re,[e("table",ne,[e("thead",ie,[e("tr",null,[e("th",de,[e("input",{type:"checkbox",checked:o.value.length===i.value.length,onChange:T,class:"w-4 h-4 text-amber-600 rounded focus:ring-amber-500"},null,40,ue)]),t[5]||(t[5]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"ID",-1)),t[6]||(t[6]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cliente",-1)),t[7]||(t[7]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Total",-1)),t[8]||(t[8]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado",-1)),t[9]||(t[9]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Fecha",-1)),t[10]||(t[10]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Acciones",-1))])]),e("tbody",ce,[(u(!0),c(H,null,P(i.value,l=>{var E;return u(),c("tr",{key:l.id,class:U(o.value.includes(l.id)?"bg-amber-50":"hover:bg-gray-50")},[e("td",ve,[F(e("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":t[0]||(t[0]=x=>o.value=x),class:"w-4 h-4 text-amber-600 rounded focus:ring-amber-500"},null,8,me),[[G,o.value]])]),e("td",pe,"#"+v(l.id),1),e("td",xe,[e("div",he,v(l.customer_name),1),e("div",ge,v((E=l.user)==null?void 0:E.email),1)]),e("td",fe,"₲ "+v(D(l.total)),1),e("td",ye,[e("select",{onChange:x=>A(l.id,x.target.value),value:l.status,class:"text-xs border-gray-300 rounded px-2 py-1 focus:ring-amber-500 focus:border-amber-500"},[...t[11]||(t[11]=[e("option",{value:"pending"},"Pendiente",-1),e("option",{value:"paid"},"Pagado",-1),e("option",{value:"cancelled"},"Cancelado",-1)])],40,be)]),e("td",_e,v(M(l.created_at)),1),e("td",ke,[e("div",we,[e("button",{onClick:x=>O(l),class:"text-green-600 hover:text-green-900",title:"Ver factura"},[...t[12]||(t[12]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])],8,Ee),e("button",{onClick:x=>V(l.id),disabled:b.value===l.id,class:"text-red-600 hover:text-red-900 disabled:text-red-400",title:"Eliminar"},[...t[13]||(t[13]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ce)])])],2)}),128))])])])])):(u(),c("div",Se,[...t[14]||(t[14]=[e("div",{class:"text-gray-400 mb-4"},[e("svg",{class:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1),e("p",{class:"text-gray-600"},"No hay pedidos registrados.",-1)])]))])]),_:1}))}},Ve=Y(Te,[["__scopeId","data-v-00e11726"]]);export{Ve as default};
