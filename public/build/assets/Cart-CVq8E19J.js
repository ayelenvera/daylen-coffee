import{r as S,Q as ne,c as P,a as J,s as le,o as ie,g as l,d as r,e as de,b as ce,u as ue,Z as pe,w as ge,f as e,t as i,F as f,h as L,i as v,j as V,l as _,p as me,v as N,n as T,m as Q,C as be,N as x}from"./app-BYhsu56_.js";import{_ as ve}from"./GuestLayout-CkBOnskT.js";import{_ as xe}from"./AuthenticatedLayout-B6T8qzH8.js";import"./HelpLink-0Gkg05qS.js";const ye={class:"py-12"},he={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},fe={key:0,class:"text-center py-12"},_e={key:1,class:"text-center py-12"},ke={key:2,class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},we={class:"lg:col-span-2"},Ce={class:"bg-white rounded-xl shadow-sm border border-gray-100"},ze={class:"px-6 py-4 border-b border-gray-100"},Se={class:"text-sm text-gray-600 mt-1"},Pe={class:"divide-y divide-gray-100"},Le={class:"flex gap-4"},Ve={class:"flex-shrink-0"},je=["src","alt"],Me={class:"flex-1 min-w-0"},Ee={class:"flex justify-between items-start"},Ae={class:"text-lg font-semibold text-gray-900"},Be={class:"text-amber-600 font-medium mt-1"},Ne={key:0,class:"text-sm text-gray-500"},Te={class:"text-right"},Ue={class:"text-xl font-bold text-gray-900"},qe={class:"text-xs text-gray-500 mt-1"},Ye={key:0},He={class:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3"},$e={class:"flex items-center gap-2"},Fe=["onUpdate:modelValue"],De={key:0,class:"flex items-center gap-2"},Re=["onUpdate:modelValue"],Ze=["value"],Ie={key:1,class:"flex items-center gap-2"},Oe=["onUpdate:modelValue"],Ge=["value"],Je={key:0,class:"mt-3"},Qe={class:"flex flex-wrap gap-2"},We=["value","onUpdate:modelValue"],Ke={class:"text-sm text-gray-700"},Xe={key:1,class:"mt-3"},es={class:"flex flex-wrap gap-2"},ss=["value","onUpdate:modelValue"],ts={class:"text-sm text-gray-700"},os={class:"mt-4 flex gap-3"},as=["onClick"],rs=["onClick","disabled"],ns={key:0,class:"animate-spin w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24"},ls={key:1,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},is={class:"px-6 py-4 border-t border-gray-100 bg-gray-50 rounded-b-xl"},ds={class:"flex justify-center"},cs=["disabled"],us={key:0,class:"animate-spin w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24"},ps={key:1,class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},gs={class:"lg:col-span-1"},ms={class:"bg-white rounded-xl shadow-sm border border-gray-100 sticky top-6"},bs={class:"p-6"},vs={class:"space-y-4"},xs={class:"flex justify-between items-center"},ys={class:"font-semibold text-gray-900"},hs={key:0,class:"flex justify-between items-center"},fs={class:"font-semibold text-amber-600"},_s={class:"flex justify-between items-center"},ks={class:"border-t border-gray-200 pt-4"},ws={class:"border-t border-gray-200 pt-4"},Cs={class:"flex justify-between items-center"},zs={class:"text-lg font-bold text-amber-600"},Ss=["disabled"],Ps={key:0,class:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24"},Ls={key:1,xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 16 16"},Bs={__name:"Cart",props:{cart:{type:Object,default:()=>({items:[],total:0,item_count:0})}},setup(Vs){const k=S(null),w=S(!1),C=S(!1),j=S("local"),y=S(0),U=ne(),M=P(()=>U.props.cart||{items:{},total:0,item_count:0}),b=P(()=>Object.values(M.value.items||{})),u=J({}),W=async()=>{for(const o of b.value)try{const t=await(await fetch(`/api/products/${o.id}/customization-rules`)).json();u[o.id]=t,console.log(`Reglas para producto ${o.id}:`,t)}catch(s){console.error("Error loading customization rules:",s),u[o.id]={enabled_options:["quantity"],size_options:[],sugar_options:[],topping_options:[],addon_options:[]}}},E=P(()=>{let o=0;return b.value.forEach(s=>{var p;const t=A(s.id)||0,d=Y(s.id)||0,c=H(s.id)||0;o+=(t+d+c)*(((p=n[s.id])==null?void 0:p.quantity)||1)}),o}),K=P(()=>(M.value.total||0)+E.value+y.value),X=o=>{var g;const s=o.price||0,t=A(o.id)||0,d=Y(o.id)||0,c=H(o.id)||0,p=((g=n[o.id])==null?void 0:g.quantity)||1;return(s+t+d+c)*p},A=o=>{var c,p;const s=(c=n[o])==null?void 0:c.size,d=(((p=u[o])==null?void 0:p.size_options)||[]).find(g=>g.name===s);return(d==null?void 0:d.price)||0},q=o=>{var s;return((s=n[o])==null?void 0:s.size)||"Mediano"},Y=o=>{var d,c;const s=((d=n[o])==null?void 0:d.toppings)||[],t=((c=u[o])==null?void 0:c.topping_options)||[];return s.reduce((p,g)=>{const m=t.find(h=>h.name===g);return p+((m==null?void 0:m.price)||0)},0)},H=o=>{var d,c;const s=((d=n[o])==null?void 0:d.addons)||[],t=((c=u[o])==null?void 0:c.addon_options)||[];return s.reduce((p,g)=>{const m=t.find(h=>h.name===g);return p+((m==null?void 0:m.price)||0)},0)},$=()=>{const o={local:5e3,medium:7e3,far:12e3};y.value=o[j.value]||0},n=J({}),ee=()=>{b.value.forEach(o=>{var s;if(!n[o.id]){const t=u[o.id]||{},c=((s=t.enabled_options)==null?void 0:s.includes("size"))&&t.default_size||null;n[o.id]={quantity:o.quantity||1,size:o.size||c,sugar:o.sugar||"Normal",toppings:o.toppings||[],addons:o.addons||[]}}})};le(M,()=>{ee(),W()},{immediate:!0,deep:!0}),ie(()=>{$()});const se=async o=>{k.value=o,await x.post("/cart/remove",{product_id:o},{preserveScroll:!0,onSuccess:()=>{x.reload({only:["cart"]})},onFinish:()=>{k.value=null}})},te=async()=>{confirm("¿Estás seguro de que quieres limpiar todo el carrito?")&&(w.value=!0,await x.delete("/cart/clear",{preserveScroll:!0,onSuccess:()=>{x.reload({only:["cart"]})},onFinish:()=>{w.value=!1}}))},oe=async o=>{const s={product_id:o,...n[o]};await x.post("/cart/update",s,{preserveScroll:!0,onSuccess:()=>{x.reload({only:["cart"]})}})},ae=async()=>{C.value=!0,b.value.map(s=>s.id);const o={};b.value.forEach(s=>{var t,d,c,p;o[s.id]={toppings:((t=n[s.id])==null?void 0:t.toppings)||[],addons:((d=n[s.id])==null?void 0:d.addons)||[],size:((c=n[s.id])==null?void 0:c.size)||null,sugar:((p=n[s.id])==null?void 0:p.sugar)||"Normal"}}),sessionStorage.setItem("personalizations",JSON.stringify(o)),sessionStorage.setItem("shippingCost",y.value),sessionStorage.setItem("selectedZone",j.value),sessionStorage.setItem("totalCustomizations",E.value),x.visit("/checkout",{onFinish:()=>{C.value=!1}})},re=P(()=>{var o;return(o=U.props.auth)!=null&&o.user?xe:ve});return(o,s)=>(r(),l(f,null,[de(ue(pe),{title:"Carrito"}),(r(),ce(be(re.value),null,{default:ge(()=>[e("div",ye,[e("div",he,[o.$page.props.auth.user&&o.$page.props.auth.user.is_admin?(r(),l("div",fe,[...s[2]||(s[2]=[e("div",{class:"text-amber-600 mb-6"},[e("svg",{class:"w-24 h-24 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})])],-1),e("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"Acceso restringido",-1),e("p",{class:"text-gray-600 mb-6"},"Los administradores no pueden acceder al carrito de compras.",-1),e("a",{href:"/admin/dashboard",class:"bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg"}," Ir al Panel de Administración ",-1)])])):b.value.length?(r(),l("div",ke,[e("div",we,[e("div",Ce,[e("div",ze,[s[4]||(s[4]=e("h2",{class:"text-xl font-bold text-gray-900"},"Tu Carrito",-1)),e("p",Se,i(b.value.length)+" "+i(b.value.length===1?"producto":"productos"),1)]),e("div",Pe,[(r(!0),l(f,null,L(b.value,t=>{var d,c,p,g,m,h,F,D,R,Z,I,O,G;return r(),l("div",{key:t.id,class:"p-6 hover:bg-gray-50 transition-colors duration-200"},[e("div",Le,[e("div",Ve,[e("img",{src:t.image,alt:t.name,class:"w-20 h-20 rounded-lg object-cover border border-gray-200",onError:s[0]||(s[0]=a=>{a.target.onerror=null,a.target.src="/images/placeholder.jpg"})},null,40,je)]),e("div",Me,[e("div",Ee,[e("div",null,[e("h3",Ae,i(t.name),1),e("p",Be,[V(" ₲ "+i(Number(t.price||0).toLocaleString("es-PY"))+" ",1),A(t.id)?(r(),l("span",Ne," + ₲ "+i(A(t.id).toLocaleString("es-PY"))+" ("+i(q(t.id))+") ",1)):v("",!0)])]),e("div",Te,[e("p",Ue," ₲ "+i(X(t).toLocaleString("es-PY")),1),e("p",qe,[V(i(q(t.id))+" ",1),(d=n[t.id])!=null&&d.sugar?(r(),l("span",Ye,"· "+i(n[t.id].sugar),1)):v("",!0)])])]),e("div",He,[e("div",$e,[s[5]||(s[5]=e("label",{class:"text-sm font-medium text-gray-700"},"Cantidad:",-1)),_(e("input",{type:"number",min:"1","onUpdate:modelValue":a=>n[t.id].quantity=a,class:"w-20 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500"},null,8,Fe),[[me,n[t.id].quantity,void 0,{number:!0}]])]),(p=(c=u[t.id])==null?void 0:c.enabled_options)!=null&&p.includes("size")&&((g=u[t.id])!=null&&g.size_options)?(r(),l("div",De,[s[6]||(s[6]=e("label",{class:"text-sm font-medium text-gray-700"},"Tamaño:",-1)),_(e("select",{"onUpdate:modelValue":a=>n[t.id].size=a,class:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 min-w-[140px]"},[(r(!0),l(f,null,L(u[t.id].size_options,a=>(r(),l("option",{key:a.name,value:a.name},i(a.name)+" (+₲"+i((a.price||0).toLocaleString("es-PY"))+") ",9,Ze))),128))],8,Re),[[N,n[t.id].size]])])):v("",!0),(h=(m=u[t.id])==null?void 0:m.enabled_options)!=null&&h.includes("sugar")&&((F=u[t.id])!=null&&F.sugar_options)?(r(),l("div",Ie,[s[7]||(s[7]=e("label",{class:"text-sm font-medium text-gray-700"},"Azúcar:",-1)),_(e("select",{"onUpdate:modelValue":a=>n[t.id].sugar=a,class:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 min-w-[120px]"},[(r(!0),l(f,null,L(u[t.id].sugar_options,a=>(r(),l("option",{key:a,value:a},i(a),9,Ge))),128))],8,Oe),[[N,n[t.id].sugar]])])):v("",!0)]),(R=(D=u[t.id])==null?void 0:D.enabled_options)!=null&&R.includes("toppings")&&((Z=u[t.id])!=null&&Z.topping_options)?(r(),l("div",Je,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Coberturas:",-1)),e("div",Qe,[(r(!0),l(f,null,L(u[t.id].topping_options,a=>{var z;return r(),l("label",{key:a.name,class:T(["flex items-center space-x-2 p-2 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer",{"bg-amber-50 border-amber-300":(z=n[t.id].toppings)==null?void 0:z.includes(a.name)}])},[_(e("input",{type:"checkbox",value:a.name,"onUpdate:modelValue":B=>n[t.id].toppings=B,class:"rounded border-gray-300 text-amber-600 focus:ring-amber-500"},null,8,We),[[Q,n[t.id].toppings]]),e("span",Ke,i(a.name)+" (+₲"+i((a.price||0).toLocaleString("es-PY"))+")",1)],2)}),128))])])):v("",!0),(O=(I=u[t.id])==null?void 0:I.enabled_options)!=null&&O.includes("addons")&&((G=u[t.id])!=null&&G.addon_options)?(r(),l("div",Xe,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Agregados:",-1)),e("div",es,[(r(!0),l(f,null,L(u[t.id].addon_options,a=>{var z;return r(),l("label",{key:a.name,class:T(["flex items-center space-x-2 p-2 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer",{"bg-amber-50 border-amber-300":(z=n[t.id].addons)==null?void 0:z.includes(a.name)}])},[_(e("input",{type:"checkbox",value:a.name,"onUpdate:modelValue":B=>n[t.id].addons=B,class:"rounded border-gray-300 text-amber-600 focus:ring-amber-500"},null,8,ss),[[Q,n[t.id].addons]]),e("span",ts,i(a.name)+" (+₲"+i((a.price||0).toLocaleString("es-PY"))+")",1)],2)}),128))])])):v("",!0),e("div",os,[e("button",{onClick:a=>oe(t.id),class:"inline-flex items-center px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium rounded-lg transition-colors duration-200"},[...s[10]||(s[10]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),V(" Actualizar ",-1)])],8,as),e("button",{onClick:a=>se(t.id),disabled:k.value===t.id,class:"inline-flex items-center px-4 py-2 text-red-600 hover:text-red-800 hover:bg-red-50 text-sm font-medium rounded-lg transition-colors duration-200 disabled:opacity-50"},[k.value===t.id?(r(),l("svg",ns,[...s[11]||(s[11]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(r(),l("svg",ls,[...s[12]||(s[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)])])),V(" "+i(k.value===t.id?"Eliminando...":"Eliminar"),1)],8,rs)])])])])}),128))]),e("div",is,[e("div",ds,[e("button",{onClick:te,disabled:w.value,class:"inline-flex items-center px-6 py-3 text-red-600 hover:text-red-800 hover:bg-red-50 font-medium rounded-lg transition-colors duration-200 border border-red-200 disabled:opacity-50"},[w.value?(r(),l("svg",us,[...s[13]||(s[13]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(r(),l("svg",ps,[...s[14]||(s[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)])])),V(" "+i(w.value?"Limpiando carrito...":"Limpiar todo el carrito"),1)],8,cs)])])])]),e("div",gs,[e("div",ms,[e("div",bs,[s[23]||(s[23]=e("h3",{class:"text-lg font-bold text-gray-900 mb-6"},"Resumen del Pedido",-1)),e("div",vs,[e("div",xs,[s[15]||(s[15]=e("span",{class:"text-gray-600"},"Subtotal productos:",-1)),e("span",ys," ₲ "+i(Number(M.value.total||0).toLocaleString("es-PY")),1)]),E.value>0?(r(),l("div",hs,[s[16]||(s[16]=e("span",{class:"text-gray-600"},"Personalizaciones:",-1)),e("span",fs," + ₲ "+i(E.value.toLocaleString("es-PY")),1)])):v("",!0),e("div",_s,[s[17]||(s[17]=e("span",{class:"text-gray-600"},"Envío:",-1)),e("span",{class:T(["font-semibold",y.value>0?"text-gray-900":"text-green-600"])},i(y.value>0?`₲ ${y.value.toLocaleString("es-PY")}`:"Gratis"),3)]),e("div",ks,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Zona de envío:",-1)),_(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>j.value=t),onChange:$,class:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500"},[...s[18]||(s[18]=[e("option",{value:"local"},"Ciudad del Este (₲ 5.000)",-1),e("option",{value:"medium"},"Pdte. Franco (₲ 7.000)",-1),e("option",{value:"far"},"Hernandarias (₲ 12.000)",-1)])],544),[[N,j.value]])]),e("div",ws,[e("div",Cs,[s[20]||(s[20]=e("span",{class:"text-lg font-bold text-gray-900"},"Total:",-1)),e("span",zs," ₲ "+i(Number(K.value).toLocaleString("es-PY")),1)])])]),e("button",{onClick:ae,disabled:C.value,class:"w-full mt-6 bg-amber-600 hover:bg-amber-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-4 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center gap-3"},[C.value?(r(),l("svg",Ps,[...s[21]||(s[21]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(r(),l("svg",Ls,[...s[22]||(s[22]=[e("path",{"fill-rule":"evenodd",d:"M10.354 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708 0"},null,-1),e("path",{d:"m10.273 2.513-.921-.944.715-.698.622.637.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636a2.89 2.89 0 0 1 4.134 0l-.715.698a1.89 1.89 0 0 0-2.704 0l-.92.944-1.32-.016a1.89 1.89 0 0 0-1.911 1.912l.016 1.318-.944.921a1.89 1.89 0 0 0 0 2.704l.944.92-.016 1.32a1.89 1.89 0 0 0 1.912 1.911l1.318-.016.921.944a1.89 1.89 0 0 0 2.704 0l.92-.944 1.32.016a1.89 1.89 0 0 0 1.911-1.912l-.016-1.318.944-.921a1.89 1.89 0 0 0 0-2.704l-.944-.92.016-1.32a1.89 1.89 0 0 0-1.912-1.911z"},null,-1)])])),e("span",null,i(C.value?"Procesando...":"Proceder al Pago"),1)],8,Ss),s[24]||(s[24]=e("a",{href:"/home",class:"w-full mt-4 bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-4 px-6 rounded-lg transition-colors duration-200 text-center block"}," Continuar Comprando ",-1))])])])])):(r(),l("div",_e,[...s[3]||(s[3]=[e("div",{class:"text-gray-400 mb-6"},[e("svg",{class:"w-24 h-24 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"})])],-1),e("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"Tu carrito está vacío",-1),e("p",{class:"text-gray-600 mb-6"},"Agrega algunos productos deliciosos para comenzar tu pedido",-1),e("a",{href:"/home",class:"bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg"}," Ver Productos ",-1)])]))])])]),_:1}))],64))}};export{Bs as default};
